toInclude = ${R_LIBRARY_DIR}/INLA/include/ 

sources = cgeneric_gpgraph_alpha1.c

all : $(sources:.c=.o) so

%.o : %.c
	@echo gnerating $@
	test -f ${R_LIBRARY_DIR}/INLA/include/cgeneric.h || test -f cgeneric.h || wget -O cgeneric.h https://raw.githubusercontent.com/hrue/r-inla/devel/inlaprog/src/cgeneric.h
	gcc -c -O3 -Wall -Wextra -fpic -I$(toInclude)  $^ -o $@

so : $(sources:.c=.o)
	@echo generate .so
	gcc -shared cgeneric_gpgraph_alpha1.o -o ../inst/shared/gpgraph_cgeneric_models.so -lblas
	
clean :
	rm -f *.o
	rm -f cgeneric.h

.PHONY: all clean