<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>On isotropic covariances on metric graphs with non-Euclidean edges • MetricGraph</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="On isotropic covariances on metric graphs with non-Euclidean edges">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MetricGraph</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/MetricGraph.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/metric_graph.html">Working with metric graphs</a></li>
    <li><a class="dropdown-item" href="../articles/random_fields.html">Gaussian random fields on metric graphs</a></li>
    <li><a class="dropdown-item" href="../articles/metric_graph_data.html">Data manipulation on metric graphs</a></li>
    <li><a class="dropdown-item" href="../articles/inlabru_interface.html">inlabru interface of Whittle--Matérn fields</a></li>
    <li><a class="dropdown-item" href="../articles/inla_interface.html">INLA interface of Whittle--Matérn fields</a></li>
    <li><a class="dropdown-item" href="../articles/fem_models.html">Whittle--Matérn fields with general smoothness</a></li>
    <li><a class="dropdown-item" href="../articles/pointprocess.html">Log-Gaussian Cox processes on metric graphs</a></li>
    <li><a class="dropdown-item" href="../articles/comparison.html">Comparison of different models using real data</a></li>
    <li><a class="dropdown-item" href="../articles/isotropic_noneuclidean.html">On isotropic covariances on metric graphs with non-Euclidean edges</a></li>
    <li><a class="dropdown-item" href="../articles/multi_likelihood.html">An example with multiple likelihoods in INLA and inlabru</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davidbolin/MetricGraph/discussions"><span class="fa fa-comments-o"></span> Discussions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davidbolin/MetricGraph/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/jdavidbolin" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>On isotropic covariances on metric graphs with non-Euclidean edges</h1>
                        <h4 data-toc-skip class="author">David Bolin,
Alexandre B. Simas, and Jonas Wallin</h4>
            
            <h4 data-toc-skip class="date">Created: 2024-02-11. Last
modified: 2024-07-07.</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/davidbolin/MetricGraph/blob/devel/vignettes/isotropic_noneuclidean.rmd" class="external-link"><code>vignettes/isotropic_noneuclidean.rmd</code></a></small>
      <div class="d-none name"><code>isotropic_noneuclidean.rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we will investigate the behavior of isotropic
covariance functions (with respect to the resistance metric) on metric
graphs with non-Euclidean edges. This boils down to studying the
resistance metric on metric graphs with non-Euclidean edges.</p>
<p>More precisely, we will show that when dealing with metric graphs
with non-Euclidean edges, the addition or removal of vertices of degree
2 can have a severe impact on the resistance metric and, a fortiori, on
the covariance function.</p>
<p>The effect of this study is that if one fits an isotropic model on a
metric graph with non-Euclidean edges by turning the observations into
vertices, then the resulting model is different from what one would
expect. Indeed, the model might change when doing predictions (as one
would need to add further observations as vertices to obtain
predictions). Furthermore, if one does not add observations as vertices,
then the actual covariance function might not be valid <a href="https://projecteuclid.org/journals/annals-of-statistics/volume-48/issue-4/Isotropic-covariance-functions-on-graphs-and-their-edges/10.1214/19-AOS1896.full" class="external-link"><span class="citation">@Anderes2020</span></a>. Actually, in <a href="https://projecteuclid.org/journals/annals-of-statistics/volume-48/issue-4/Isotropic-covariance-functions-on-graphs-and-their-edges/10.1214/19-AOS1896.full" class="external-link"><span class="citation">@Anderes2020</span></a>, such models were not defined,
as they only define Gaussian models with isotropic covariance functions
for metric graphs with Euclidean edges. One option, therefore, would be
to simply not allow one to fit such models at all as they are not
consistent. However, in the package we chose to only give a warning, and
let the user decide what to do.</p>
</div>
<div class="section level2">
<h2 id="a-simple-example">A simple example<a class="anchor" aria-label="anchor" href="#a-simple-example"></a>
</h2>
<p>We start by creating a metric graph with multiple edges. This metric
graph does not have Euclidean edges:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edge1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">theta1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="va">pi</span><span class="op">/</span><span class="fl">2</span>,to<span class="op">=</span><span class="fl">0</span>,length.out <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">theta2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="va">pi</span>,to<span class="op">=</span><span class="fl">3</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">2</span>,length.out <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">edge2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">theta1</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">theta1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edge3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">theta2</span><span class="op">)</span>,<span class="fl">1</span><span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">theta2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edges</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">edge1</span>, <span class="va">edge2</span>, <span class="va">edge3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/metric_graph.html">metric_graph</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>edges <span class="op">=</span> <span class="va">edges</span><span class="op">)</span></span>
<span></span>
<span><span class="va">graph</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="isotropic_noneuclidean_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<p>One can also check if a metric graph has Euclidean edges by calling
the <code>check_euclidean()</code> method, then calling the
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph</span><span class="op">$</span><span class="fu">check_euclidean</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">graph</span><span class="op">)</span></span>
<span><span class="co">#&gt; A metric graph object with:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Vertices:</span></span>
<span><span class="co">#&gt;   Total: 3 </span></span>
<span><span class="co">#&gt;   Degree 1: 1;  Degree 2: 1;  Degree 3: 1; </span></span>
<span><span class="co">#&gt;   With incompatible directions:  2 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Edges: </span></span>
<span><span class="co">#&gt;   Total: 3 </span></span>
<span><span class="co">#&gt;   Lengths: </span></span>
<span><span class="co">#&gt;       Min: 1  ; Max: 1.570729  ; Total: 4.141458 </span></span>
<span><span class="co">#&gt;   Weights: </span></span>
<span><span class="co">#&gt;       Min: 1  ; Max: 1 </span></span>
<span><span class="co">#&gt;   That are circles:  0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Graph units: </span></span>
<span><span class="co">#&gt;   Vertices unit:  None  ; Lengths unit:  None </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Longitude and Latitude coordinates:  FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Some characteristics of the graph:</span></span>
<span><span class="co">#&gt;   Connected: TRUE</span></span>
<span><span class="co">#&gt;   Has loops: FALSE</span></span>
<span><span class="co">#&gt;   Has multiple edges: TRUE</span></span>
<span><span class="co">#&gt;   Is a tree: FALSE</span></span>
<span><span class="co">#&gt;   Distance consistent: TRUE</span></span>
<span><span class="co">#&gt;   Has Euclidean edges: FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computed quantities inside the graph: </span></span>
<span><span class="co">#&gt;   Laplacian:  FALSE  ; Geodesic distances:  TRUE </span></span>
<span><span class="co">#&gt;   Resistance distances:  FALSE  ; Finite element matrices:  FALSE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Mesh: The graph has no mesh! </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data: The graph has no data!</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tolerances: </span></span>
<span><span class="co">#&gt;   vertex-vertex:  0.001 </span></span>
<span><span class="co">#&gt;   vertex-edge:  0.001 </span></span>
<span><span class="co">#&gt;   edge-edge:  0</span></span></code></pre></div>
<p>Let us now compute the resistance distances between the vertices
using the <code>compute_resdist()</code> method:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph</span><span class="op">$</span><span class="fu">compute_resdist</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can now observe the resistance distances in the
<code>res_dist</code> element of <code>graph</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_dist_graph</span> <span class="op">&lt;-</span> <span class="va">graph</span><span class="op">$</span><span class="va">res_dist</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>In reality, what is being actually done to the metric graph, is that
one of the edges is, in practice, being ignored. Indeed, let us create a
metric graph with Euclidean edges obtained by removing one of the edges,
and compute the resistance distance between its vertices. Thus, we start
by creating such a metric graph:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edge1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">theta1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="va">pi</span><span class="op">/</span><span class="fl">2</span>,to<span class="op">=</span><span class="fl">0</span>,length.out <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">edge2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">theta1</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">theta1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">edges2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">edge1</span>, <span class="va">edge2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">graph2</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/metric_graph.html">metric_graph</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>edges <span class="op">=</span> <span class="va">edges2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">graph2</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="isotropic_noneuclidean_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Observe that it has Euclidean edges:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph2</span><span class="op">$</span><span class="fu">check_euclidean</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">graph2</span><span class="op">)</span></span>
<span><span class="co">#&gt; A metric graph object with:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Vertices:</span></span>
<span><span class="co">#&gt;   Total: 3 </span></span>
<span><span class="co">#&gt;   Degree 1: 2;  Degree 2: 1; </span></span>
<span><span class="co">#&gt;   With incompatible directions:  1 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Edges: </span></span>
<span><span class="co">#&gt;   Total: 2 </span></span>
<span><span class="co">#&gt;   Lengths: </span></span>
<span><span class="co">#&gt;       Min: 1  ; Max: 1.570729  ; Total: 2.570729 </span></span>
<span><span class="co">#&gt;   Weights: </span></span>
<span><span class="co">#&gt;       Min: 1  ; Max: 1 </span></span>
<span><span class="co">#&gt;   That are circles:  0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Graph units: </span></span>
<span><span class="co">#&gt;   Vertices unit:  None  ; Lengths unit:  None </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Longitude and Latitude coordinates:  FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Some characteristics of the graph:</span></span>
<span><span class="co">#&gt;   Connected: TRUE</span></span>
<span><span class="co">#&gt;   Has loops: FALSE</span></span>
<span><span class="co">#&gt;   Has multiple edges: FALSE</span></span>
<span><span class="co">#&gt;   Is a tree: TRUE</span></span>
<span><span class="co">#&gt;   Distance consistent: TRUE</span></span>
<span><span class="co">#&gt;   Has Euclidean edges: TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computed quantities inside the graph: </span></span>
<span><span class="co">#&gt;   Laplacian:  FALSE  ; Geodesic distances:  TRUE </span></span>
<span><span class="co">#&gt;   Resistance distances:  FALSE  ; Finite element matrices:  FALSE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Mesh: The graph has no mesh! </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Data: The graph has no data!</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tolerances: </span></span>
<span><span class="co">#&gt;   vertex-vertex:  0.001 </span></span>
<span><span class="co">#&gt;   vertex-edge:  0.001 </span></span>
<span><span class="co">#&gt;   edge-edge:  0</span></span></code></pre></div>
<p>Let us now compute the resistance distances:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph2</span><span class="op">$</span><span class="fu">compute_resdist</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now, let us compare the resistance distances:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">res_dist_graph</span>, <span class="va">graph2</span><span class="op">$</span><span class="va">res_dist</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Therefore, indeed, one of the edges is being ignored in practice.</p>
<p>Let us now see what happens when we have observations on both edges,
and compute the resistance distances on the resulting metric graph (in
which the observations were turned into vertices).</p>
<p>To this end, let us create some observations and add them to
<code>graph</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>edge_number <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, distance_on_edge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">graph</span><span class="op">$</span><span class="fu">add_observations</span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_data</span>, normalized <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Adding observations...</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">graph</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>data<span class="op">=</span><span class="st">"y"</span><span class="op">)</span></span></code></pre></div>
<p><img src="isotropic_noneuclidean_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Let us now compute the resistance distances between the original
vertices. To this end we will use the <code>compute_resdist()</code>
method with the arguments <code>full=TRUE</code> to compute the
resistance distance at all available locations, and
<code>include_vertices=TRUE</code> to include the original vertices of
the metric graph in the result.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph</span><span class="op">$</span><span class="fu">compute_resdist</span><span class="op">(</span>full<span class="op">=</span><span class="cn">TRUE</span>, include_vertices <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Since we have 3 vertices, the resistance distances between the
original vertices are given by the elements 1 to 3 of the resulting
matrix:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_dist_orig</span> <span class="op">&lt;-</span> <span class="va">graph</span><span class="op">$</span><span class="va">res_dist</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">res_dist_orig</span></span>
<span><span class="co">#&gt; 3 x 3 Matrix of class "dgeMatrix"</span></span>
<span><span class="co">#&gt;           [,1]     [,2]      [,3]</span></span>
<span><span class="co">#&gt; [1,] 0.0000000 1.000000 0.7853645</span></span>
<span><span class="co">#&gt; [2,] 1.0000000 0.000000 1.7853645</span></span>
<span><span class="co">#&gt; [3,] 0.7853645 1.785365 0.0000000</span></span></code></pre></div>
<p>We can observe that the resistance distances are very different.
Thus, the impact of adding observations when computing resistance
distances on non-Euclidean metric graphs is severe.</p>
<p>In particular, the impact on the covariance function is severe. For
example, let us consider an exponential covariance function with
<code>sigma=1</code> and <code>kappa=1</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/exp_covariance.html">exp_covariance</a></span><span class="op">(</span><span class="va">res_dist_graph</span>, theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 3 x 3 Matrix of class "dgeMatrix"</span></span>
<span><span class="co">#&gt;           [,1]       [,2]       [,3]</span></span>
<span><span class="co">#&gt; [1,] 1.0000000 0.36787944 0.20789356</span></span>
<span><span class="co">#&gt; [2,] 0.3678794 1.00000000 0.07647977</span></span>
<span><span class="co">#&gt; [3,] 0.2078936 0.07647977 1.00000000</span></span></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/exp_covariance.html">exp_covariance</a></span><span class="op">(</span><span class="va">res_dist_orig</span>, theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 3 x 3 Matrix of class "dgeMatrix"</span></span>
<span><span class="co">#&gt;           [,1]      [,2]      [,3]</span></span>
<span><span class="co">#&gt; [1,] 1.0000000 0.3678794 0.4559535</span></span>
<span><span class="co">#&gt; [2,] 0.3678794 1.0000000 0.1677359</span></span>
<span><span class="co">#&gt; [3,] 0.4559535 0.1677359 1.0000000</span></span></code></pre></div>
<p>This shows that these are two different models. One considering the
original metric graph, and another, considering the metric graph with
the added observations. Therefore, when one considers a model with
isotropic covariance function on a metric graph with non-Euclidean edges
to perform statistical analysis, different models are considered in the
different stages of the statistical analysis. More precisely, one
believes the model being considered only depends on the original
vertices of the metric graph, when, in reality, when fitting the model,
the resistance distances are computed on a different metric graph that
was obtained when the observations were turned into vertices of a new
metric graph. Finally, when one does prediction, yet another metric
graph will be considered, namely, the metric graph in which the
prediction locations were added as vertices of yet another metric
graph.</p>
<p>Thus, we do not recommend using isotropic covariance models on metric
graphs with non-Euclidean edges, even if the model is capable of being
fitted, as there will be several inconsistencies between the original
model, the fitted model, and the model used to obtain predictions.</p>
<p>It is important to mention that the same phenomenon occur in the
Matérn Gaussian models based on the graph Laplacian. Whenever we want to
do prediction, we need to add the observation locations as vertices,
thus modifying the graph. This means that there is an inconsistency
between the model used to fit the data, and the model used to obtain
prediction.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Bolin, Alexandre Simas, Jonas Wallin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
