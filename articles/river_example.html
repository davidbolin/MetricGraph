<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<<<<<<< HEAD
<meta name="description" content="MetricGraph">
=======
>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada
<title>An example with a river graph model • MetricGraph</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet">
<<<<<<< HEAD
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An example with a river graph model">
<meta property="og:description" content="MetricGraph">
<meta property="og:image" content="https://davidbolin.github.io/MetricGraph/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
=======
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An example with a river graph model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada
    <a class="navbar-brand me-2" href="../index.html">MetricGraph</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0.9000</small>

<<<<<<< HEAD
    
=======

>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<<<<<<< HEAD
<li class="nav-item">
  <a class="nav-link" href="../articles/MetricGraph.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/metric_graph.html">Working with metric graphs</a>
    <a class="dropdown-item" href="../articles/random_fields.html">Gaussian random fields on metric graphs</a>
    <a class="dropdown-item" href="../articles/metric_graph_data.html">Data manipulation on metric graphs</a>
    <a class="dropdown-item" href="../articles/inlabru_interface.html">inlabru interface of Whittle--Matern fields</a>
    <a class="dropdown-item" href="../articles/inla_interface.html">INLA interface of Whittle--Matern fields</a>
    <a class="dropdown-item" href="../articles/fem_models.html">Whittle--Matern fields with general smoothness</a>
    <a class="dropdown-item" href="../articles/pointprocess.html">Log-Gaussian Cox processes on metric graphs</a>
    <a class="dropdown-item" href="../articles/comparison.html">Comparison of different models using real data</a>
    <a class="dropdown-item" href="../articles/isotropic_noneuclidean.html">On isotropic covariances on metric graphs with non-Euclidean edges</a>
    <a class="dropdown-item" href="../articles/multi_likelihood.html">An example with multiple likelihoods in INLA and inlabru</a>
    <a class="dropdown-item" href="../articles/directional_model.html">An example with directional models</a>
    <a class="dropdown-item" href="../articles/river_example.html">An example with a river graph model</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/davidbolin/MetricGraph/discussions">
    <span class="fa fa-comments-o"></span>
     
    Discussions
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/davidbolin/MetricGraph/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/jdavidbolin" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>

    
=======
<li class="nav-item"><a class="nav-link" href="../articles/MetricGraph.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/metric_graph.html">Working with metric graphs</a></li>
    <li><a class="dropdown-item" href="../articles/random_fields.html">Gaussian random fields on metric graphs</a></li>
    <li><a class="dropdown-item" href="../articles/metric_graph_data.html">Data manipulation on metric graphs</a></li>
    <li><a class="dropdown-item" href="../articles/inlabru_interface.html">inlabru interface of Whittle--Matern fields</a></li>
    <li><a class="dropdown-item" href="../articles/inla_interface.html">INLA interface of Whittle--Matern fields</a></li>
    <li><a class="dropdown-item" href="../articles/fem_models.html">Whittle--Matern fields with general smoothness</a></li>
    <li><a class="dropdown-item" href="../articles/pointprocess.html">Log-Gaussian Cox processes on metric graphs</a></li>
    <li><a class="dropdown-item" href="../articles/comparison.html">Comparison of different models using real data</a></li>
    <li><a class="dropdown-item" href="../articles/isotropic_noneuclidean.html">On isotropic covariances on metric graphs with non-Euclidean edges</a></li>
    <li><a class="dropdown-item" href="../articles/multi_likelihood.html">An example with multiple likelihoods in INLA and inlabru</a></li>
    <li><a class="dropdown-item" href="../articles/directional_model.html">An example with directional models</a></li>
    <li><a class="dropdown-item" href="../articles/river_example.html">An example with a river graph model</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davidbolin/MetricGraph/discussions"><span class="fa fa-comments-o"></span> Discussions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davidbolin/MetricGraph/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/jdavidbolin" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
      </ul>
</div>


>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>An example with a river graph model</h1>
                        <h4 data-toc-skip class="author">David Bolin,
Alexandre B. Simas, and Jonas Wallin</h4>
            
            <h4 data-toc-skip class="date">Created: 2024-08-08. Last
<<<<<<< HEAD
modified: 2024-08-20.</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/davidbolin/MetricGraph/blob/HEAD/vignettes/river_example.Rmd" class="external-link"><code>vignettes/river_example.Rmd</code></a></small>
=======
modified: 2024-08-19.</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/davidbolin/MetricGraph/blob/devel/vignettes/river_example.Rmd" class="external-link"><code>vignettes/river_example.Rmd</code></a></small>
>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada
      <div class="d-none name"><code>river_example.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we explore how to build a directional graph model on
a river network. The data is imported from the package
<<<<<<< HEAD
<code>SSN2</code>.</p>
=======
<code>SNR2</code>.</p>
>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada
</div>
<div class="section level2">
<h2 id="setting-up-the-data">Setting up the data<a class="anchor" aria-label="anchor" href="#setting-up-the-data"></a>
</h2>
<p>Here we take the data as is described in the <a href="https://cran.r-project.org/web/packages/SSN2/vignettes/introduction.html" class="external-link">Vignette
<<<<<<< HEAD
of <code>SSN2</code></a>. We will use the <code>geometry</code> object
=======
of <code>SNR2</code></a>. We will use the <code>geometry</code> object
>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada
from the <code>SSN</code> object to build the <code>metricGraph</code>
object. We also load the observations and the relevant covariates. We
assume that in the <code>geometry</code> object the lines are so that
they go downwards along the river.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidbolin.github.io/MetricGraph/">MetricGraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usepa.github.io/SSN2/" class="external-link">SSN2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://usepa.github.io/SSN2/reference/copy_lsn_to_temp.html" class="external-link">copy_lsn_to_temp</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"MiddleFork04.ssn"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mf04p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/SSN2/reference/ssn_import.html" class="external-link">ssn_import</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="va">path</span>,</span>
<span>  predpts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pred1km"</span>, <span class="st">"CapeHorn"</span><span class="op">)</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<<<<<<< HEAD
<span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/metric_graph.html">metric_graph</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">mf04p</span><span class="op">$</span><span class="va">edges</span><span class="op">$</span><span class="va">geometry</span>, perform_merges <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
=======
<span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/metric_graph.html">metric_graph</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">mf04p</span><span class="op">$</span><span class="va">edges</span><span class="op">$</span><span class="va">geometry</span>, longlat <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada
<span></span>
<span><span class="va">obs_coords</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">mf04p</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>coordx      <span class="op">=</span> <span class="va">obs_coords</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                   coordy      <span class="op">=</span> <span class="va">obs_coords</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                   y                <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="va">Summer_mn</span>,</span>
<span>                   elev             <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="va">ELEV_DEM</span>,</span>
<span>                   slope            <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="va">SLOPE</span>,</span>
<span>                   netid            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">mf04p</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="va">netID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">graph</span><span class="op">$</span><span class="fu">add_observations</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                       data_coords <span class="op">=</span> <span class="st">"spatial"</span>,</span>
<span>                       coord_x <span class="op">=</span> <span class="st">"coordx"</span>,</span>
<span>                       coord_y <span class="op">=</span> <span class="st">"coordy"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] coordx coordy y      elev   slope  netid </span></span>
<span><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></span></code></pre>
<p>We can now visualize the river and the data</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>data <span class="op">=</span> <span class="st">"y"</span>, vertex_size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="river_example_files/figure-html/unnamed-chunk-2-1.png" width="700" style="display: block; margin: auto;">
# Non directional models We start with fitting the non directional
models.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#fitting model with different smoothness</span></span>
<<<<<<< HEAD
<span><span class="va">model.wm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/graph_lme.html">graph_lme</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">elev</span> <span class="op">+</span> <span class="va">slope</span> <span class="op">+</span> <span class="va">netid</span>, graph <span class="op">=</span> <span class="va">graph</span>, model <span class="op">=</span> <span class="st">'wm1'</span><span class="op">)</span></span>
<span><span class="va">model.wm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/graph_lme.html">graph_lme</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">elev</span> <span class="op">+</span> <span class="va">slope</span> <span class="op">+</span> <span class="va">netid</span>, graph <span class="op">=</span> <span class="va">graph</span>, model <span class="op">=</span> <span class="st">'wm2'</span><span class="op">)</span></span></code></pre></div>
<p>We also create the cross validation results to see how the models
perform. Here we see that setting <span class="math inline">\(\alpha=2\)</span>, i.e. one time differential, has
a much worse performance compared to <span class="math inline">\(\alpha=1\)</span>, i.e. continuous but
non-differential.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
=======
<span><span class="va">model.wm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/graph_lme.html">graph_lme</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">elev</span><span class="op">+</span><span class="va">slope</span> <span class="op">+</span> <span class="va">netid</span>, graph <span class="op">=</span> <span class="va">graph</span>, model <span class="op">=</span> <span class="st">'WM1'</span><span class="op">)</span></span>
<span><span class="va">model.wm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/graph_lme.html">graph_lme</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">elev</span><span class="op">+</span><span class="va">slope</span> <span class="op">+</span> <span class="va">netid</span>, graph <span class="op">=</span> <span class="va">graph</span>, model <span class="op">=</span> <span class="st">'WM2'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in graph_lme(y ~ elev + slope + netid, graph = graph, model = "WM2"):</span></span>
<span><span class="co">## All optimization methods failed to provide a positive-definite Hessian. The</span></span>
<span><span class="co">## optimization method with largest likelihood was chosen. You can try to obtain a</span></span>
<span><span class="co">## positive-definite Hessian by setting 'improve_hessian' to TRUE.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in sqrt(diag(inv_fisher)): NaNs produced</span></span></code></pre>
<p>We also create the cross validation results to see how the models
perform. Here we see that setting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\alpha=2</annotation></semantics></math>,
i.e. one time differential, has a much worse performance compared to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\alpha=1</annotation></semantics></math>,
i.e. continuous but non-differential.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada
<code class="sourceCode R"><span><span class="va">cross.wm1</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/posterior_crossvalidation.html">posterior_crossvalidation</a></span><span class="op">(</span><span class="va">model.wm1</span><span class="op">)</span></span>
<span><span class="va">cross.wm2</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/posterior_crossvalidation.html">posterior_crossvalidation</a></span><span class="op">(</span><span class="va">model.wm2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cross.scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">cross.wm1</span><span class="op">$</span><span class="va">scores</span>,<span class="va">cross.wm2</span><span class="op">$</span><span class="va">scores</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">cross.scores</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha=1"</span>,<span class="st">"alpha=2"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Setting row names on a tibble is deprecated.</span></span></code></pre>
<<<<<<< HEAD
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
=======
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cross.scores</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">##   logscore  crps scrps   mae  rmse</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">*</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<<<<<<< HEAD
<span><span class="co">## <span style="color: #BCBCBC;">1</span>    0.792 0.278 0.717 0.353 0.504</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>    0.827 0.292 0.743 0.382 0.530</span></span></code></pre>
=======
<span><span class="co">## <span style="color: #BCBCBC;">1</span>    0.800 0.283 0.724 0.371 0.519</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>    1.39  0.534 1.03  0.700 0.968</span></span></code></pre>
>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada
</div>
<div class="section level2">
<h2 id="directional-models">Directional models<a class="anchor" aria-label="anchor" href="#directional-models"></a>
</h2>
<p>We now start with fitting various directional model. We start with
having the “boundary condition” that at an edge the sum of the downward
vertices should equal the upward vertices. That is if we have three
<<<<<<< HEAD
edges <span class="math inline">\(e_1,e_2,e_3\)</span> connected so that
<span class="math inline">\(e_1,e_2\)</span> merge into <span class="math inline">\(e_3\)</span> we have at the vertex connecting them
<span class="math display">\[
u_{e_3}(v) = u_{e_1}(v) + u_{e_2}(v).
\]</span> This is the default option in <code>metricGraph</code> and is
created by:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res.wm1.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/graph_lme.html">graph_lme</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">elev</span> <span class="op">+</span> <span class="va">slope</span> <span class="op">+</span> <span class="va">netid</span>, graph <span class="op">=</span> <span class="va">graph</span>, model <span class="op">=</span> <span class="st">'wmd1'</span><span class="op">)</span></span></code></pre></div>
<p>Here one can see a big improvement by adding using the directional
model over the non directional.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
=======
edges
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mn>1</mn></msub><mo>,</mo><msub><mi>e</mi><mn>2</mn></msub><mo>,</mo><msub><mi>e</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">e_1,e_2,e_3</annotation></semantics></math>
connected so that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mn>1</mn></msub><mo>,</mo><msub><mi>e</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">e_1,e_2</annotation></semantics></math>
merge into
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>e</mi><mn>3</mn></msub><annotation encoding="application/x-tex">e_3</annotation></semantics></math>
we have at the vertex connecting them
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><msub><mi>e</mi><mn>3</mn></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>u</mi><msub><mi>e</mi><mn>1</mn></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>u</mi><msub><mi>e</mi><mn>2</mn></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
u_{e_3}(v) = u_{e_1}(v) + u_{e_2}(v).
</annotation></semantics></math> This is the default option in
<code>metricGraph</code> and is created by:</p>
<p>Here one can see a big improvement by adding using the directional
model over the non directional.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada
<code class="sourceCode R"><span><span class="va">cross.wm1.dir</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/posterior_crossvalidation.html">posterior_crossvalidation</a></span><span class="op">(</span><span class="va">res.wm1.dir</span><span class="op">)</span></span>
<span><span class="va">cross.scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">cross.scores</span>,<span class="va">cross.wm1.dir</span><span class="op">$</span><span class="va">scores</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cross.scores</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">##   logscore  crps scrps   mae  rmse</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">*</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<<<<<<< HEAD
<span><span class="co">## <span style="color: #BCBCBC;">1</span>    0.792 0.278 0.717 0.353 0.504</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>    0.827 0.292 0.743 0.382 0.530</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>    0.379 0.214 0.537 0.296 0.400</span></span></code></pre>
<p>We could use other constraints. For instance in .. the authors used
constraint not so the sum is equal but rather the variance of the in is
constant which is obtained by <span class="math display">\[
u_{e_3}(v) = \sqrt{w_1}u_{e_1}(v) + \sqrt{w_2}u_{e_2}(v).
\]</span> here the weights are set by the edge variable <code>h2</code>.
To make this work in the metricgraph package one uses the following
line</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph</span><span class="op">$</span><span class="fu">set_edge_weights</span><span class="op">(</span>weights<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>h2 <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">edges</span><span class="op">$</span><span class="va">h2oAreaKm2</span><span class="op">)</span>, </span>
<span>                  directional_weights <span class="op">=</span> <span class="st">'h2'</span><span class="op">)</span></span>
<span><span class="va">graph</span><span class="op">$</span><span class="fu">setDirectionalWeightFunction</span><span class="op">(</span>f_in <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">res.wm1.dir2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/graph_lme.html">graph_lme</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">elev</span><span class="op">+</span><span class="va">slope</span> <span class="op">+</span> <span class="va">netid</span>, graph <span class="op">=</span> <span class="va">graph</span>, model <span class="op">=</span> <span class="st">'wmd1'</span><span class="op">)</span></span></code></pre></div>
<p>Here we see a slight dip in performance but still much better than
the symmetric version.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
=======
<span><span class="co">## <span style="color: #BCBCBC;">1</span>    0.800 0.283 0.724 0.371 0.519</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>    1.39  0.534 1.03  0.700 0.968</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>    0.371 0.212 0.532 0.289 0.396</span></span></code></pre>
<p>We could use other constraints. For instance in .. the authors used
constraint not so the sum is equal but rather the variance of the in is
constant which is obtained by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><msub><mi>e</mi><mn>3</mn></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msqrt><msub><mi>w</mi><mn>1</mn></msub></msqrt><msub><mi>u</mi><msub><mi>e</mi><mn>1</mn></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msqrt><msub><mi>w</mi><mn>2</mn></msub></msqrt><msub><mi>u</mi><msub><mi>e</mi><mn>2</mn></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>v</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
u_{e_3}(v) = \sqrt{w_1}u_{e_1}(v) + \sqrt{w_2}u_{e_2}(v).
</annotation></semantics></math> here the weights are set by the edge
variable <code>h2</code>. To make this work in the metricgraph package
one uses the following line</p>
<pre><code><span><span class="co">## Warning in graph_lme(y ~ elev + slope + netid, graph = graph, model = "wmd1", :</span></span>
<span><span class="co">## All optimization methods failed to provide a positive-definite Hessian. The</span></span>
<span><span class="co">## optimization method with largest likelihood was chosen. You can try to obtain a</span></span>
<span><span class="co">## positive-definite Hessian by setting 'improve_hessian' to TRUE.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in sqrt(diag(inv_fisher)): NaNs produced</span></span></code></pre>
<p>Here we see a slight dip in performance but still much better than
the symmetric version.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada
<code class="sourceCode R"><span><span class="va">cross.wm1.dir2</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/posterior_crossvalidation.html">posterior_crossvalidation</a></span><span class="op">(</span><span class="va">res.wm1.dir2</span><span class="op">)</span></span>
<span><span class="va">cross.scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">cross.scores</span>,<span class="va">cross.wm1.dir2</span><span class="op">$</span><span class="va">scores</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cross.scores</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">##   logscore  crps scrps   mae  rmse</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">*</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<<<<<<< HEAD
<span><span class="co">## <span style="color: #BCBCBC;">1</span>    0.792 0.278 0.717 0.353 0.504</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>    0.827 0.292 0.743 0.382 0.530</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>    0.379 0.214 0.537 0.296 0.400</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>    0.493 0.226 0.593 0.315 0.405</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
=======
<span><span class="co">## <span style="color: #BCBCBC;">1</span>    0.800 0.283 0.724 0.371 0.519</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>    1.39  0.534 1.03  0.700 0.968</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>    0.371 0.212 0.532 0.289 0.396</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>    0.518 0.231 0.603 0.322 0.414</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Bolin, Alexandre Simas, Jonas Wallin.</p>
</div>

<div class="pkgdown-footer-right">
<<<<<<< HEAD
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
=======
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada
</div>

    </footer>
</div>

<<<<<<< HEAD
  

  
=======



>>>>>>> 7d5e007f72e1705b8671582ffb9468ceaaf4bada

  </body>
</html>
