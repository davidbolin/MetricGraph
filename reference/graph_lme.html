<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Metric graph linear mixed effects models — graph_lme • MetricGraph</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Metric graph linear mixed effects models — graph_lme"><meta name="description" content="Fitting linear mixed effects model in metric graphs. The random effects can be
Gaussian Whittle-Matern fields, discrete Gaussian Markov random fields based
on the graph Laplacian, as well as Gaussian random fields with isotropic
covariance functions."><meta property="og:description" content="Fitting linear mixed effects model in metric graphs. The random effects can be
Gaussian Whittle-Matern fields, discrete Gaussian Markov random fields based
on the graph Laplacian, as well as Gaussian random fields with isotropic
covariance functions."><meta property="og:image" content="https://davidbolin.github.io/MetricGraph/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MetricGraph</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/MetricGraph.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/metric_graph.html">Working with metric graphs</a></li>
    <li><a class="dropdown-item" href="../articles/random_fields.html">Gaussian random fields on metric graphs</a></li>
    <li><a class="dropdown-item" href="../articles/metric_graph_data.html">Data manipulation on metric graphs</a></li>
    <li><a class="dropdown-item" href="../articles/inlabru_interface.html">inlabru interface of Whittle--Matern fields</a></li>
    <li><a class="dropdown-item" href="../articles/inla_interface.html">INLA interface of Whittle--Matern fields</a></li>
    <li><a class="dropdown-item" href="../articles/fem_models.html">Whittle--Matern fields with general smoothness</a></li>
    <li><a class="dropdown-item" href="../articles/pointprocess.html">Log-Gaussian Cox processes on metric graphs</a></li>
    <li><a class="dropdown-item" href="../articles/comparison.html">Comparison of different models using real data</a></li>
    <li><a class="dropdown-item" href="../articles/isotropic_noneuclidean.html">On isotropic covariances on metric graphs with non-Euclidean edges</a></li>
    <li><a class="dropdown-item" href="../articles/multi_likelihood.html">An example with multiple likelihoods in INLA and inlabru</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davidbolin/MetricGraph/discussions"><span class="fa fa-comments-o"></span> Discussions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/davidbolin/MetricGraph/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/jdavidbolin" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Metric graph linear mixed effects models</h1>
      <small class="dont-index">Source: <a href="https://github.com/davidbolin/MetricGraph/blob/devel/R/graph_lme.R" class="external-link"><code>R/graph_lme.R</code></a></small>
      <div class="d-none name"><code>graph_lme.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fitting linear mixed effects model in metric graphs. The random effects can be
Gaussian Whittle-Matern fields, discrete Gaussian Markov random fields based
on the graph Laplacian, as well as Gaussian random fields with isotropic
covariance functions.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">graph_lme</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">graph</span>,</span>
<span>  model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"linearModel"</span><span class="op">)</span>,</span>
<span>  which_repl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  optim_method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>,</span>
<span>  possible_methods <span class="op">=</span> <span class="st">"L-BFGS-B"</span>,</span>
<span>  model_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  BC <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  previous_fit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fix_coeff <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  optim_controls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  improve_hessian <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  hessian_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  check_euclidean <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>Formula object describing the relation between the response
variables and the fixed effects.</p></dd>


<dt id="arg-graph">graph<a class="anchor" aria-label="anchor" href="#arg-graph"></a></dt>
<dd><p>A <code>metric_graph</code> object.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>The random effects model that will be used (it also includes the
option of not having any random effects). It can be either a character,
whose options are 'lm', for linear models without random effects; 'WM1' and
'WM2' for Whittle-Matern models with \(\alpha\)=1 and 2, with exact
precision matrices, respectively; 'WM' for Whittle-Matern models where one
also estimates the smoothness parameter via finite-element method; 'isoExp'
for a model with isotropic exponential covariance; 'GL1' and 'GL2' for a
SPDE model based on graph Laplacian with \(\alpha\) = 1 and 2, respectively.
'WMD1' is the directed Whittle-Matern with  \(\alpha\)=1.
There is also the option to provide it as a list containing the elements
<code>type</code>, which can be <code>linearModel</code>, <code>WhittleMatern</code>, <code>graphLaplacian</code> or <code>isoCov</code>.
<code>linearModel</code> corresponds to a linear model without random effects.
For <code>WhittleMatern</code> models, that is, if the list contains <code>type = 'WhittleMatern'</code>,
one can choose between a finite element approximation of the precision matrix
by adding <code>fem = TRUE</code> to the list, or to use the exact precision matrix
(by setting <code>fem = FALSE</code>). If <code>fem</code> is <code>FALSE</code>, there is also the parameter
<code>alpha</code>, to determine the order of the SPDE, which is either 1 or 2. If <code>fem</code>
is <code>FALSE</code> and <code>alpha</code> is not specified, then the default value of <code>alpha=1</code>
will be used. If <code>fem</code> is <code>TRUE</code> and one does not specify <code>alpha</code>, it will be
estimated from the data. However, if one wants to have <code>alpha</code> fixed to some
value, the user can specify either <code>alpha</code> or <code>nu</code> in the list. See the
vignettes for examples. Finally, for type 'WhittleMatern', there is an optional
argument, <code>rspde_order</code>, that chooses the order of the rational approximation.
By default <code>rspde_order</code> is 2.
Finally, if one wants to fit a nonstationary model, then <code>fem</code> necessarily
needs to be <code>TRUE</code>, and one needs to also supply the matrices <code>B.tau</code>
and <code>B.kappa</code> or <code>B.range</code> and <code>B.sigma</code>.
For <code>graph-Laplacian</code> models, the list must also contain a parameter <code>alpha</code>
(which is 1 by default). For <code>isoCov</code> models, the list must
contain a parameter <code>cov_function</code>, containing the covariance function.
The function accepts a string input for the following covariance functions:
'exp_covariance', 'WM1', 'WM2', 'GL1', 'GL2'. For another covariance function,
the function itself must be provided as the <code>cov_function</code> argument. The
default is 'exp_covariance', the exponential covariance. We also have
covariance-based versions of the Whittle-Matern and graph Laplacian models,
however they are much slower, they are the following (string) values for
'cov_function': 'alpha1' and 'alpha2' for Whittle-Matern fields, and 'GL1'
and 'GL2' for graph Laplacian models. Finally, for <code>Whittle-Matern</code> models,
there is an additional parameter <code>version</code>, which can be either 1 or 2, to
tell which version of the likelihood should be used. Version is 1 by default.</p></dd>


<dt id="arg-which-repl">which_repl<a class="anchor" aria-label="anchor" href="#arg-which-repl"></a></dt>
<dd><p>Vector or list containing which replicates to consider in
the model. If <code>NULL</code> all replicates will be considered.</p></dd>


<dt id="arg-optim-method">optim_method<a class="anchor" aria-label="anchor" href="#arg-optim-method"></a></dt>
<dd><p>The method to be used with <code>optim</code> function.</p></dd>


<dt id="arg-possible-methods">possible_methods<a class="anchor" aria-label="anchor" href="#arg-possible-methods"></a></dt>
<dd><p>Which methods to try in case the optimization fails or the hessian is not positive definite. The options are 'Nelder-Mead', 'L-BFGS-B', 'BFGS', 'CG' and 'SANN'. By default only 'L-BFGS-B' is considered.</p></dd>


<dt id="arg-model-options">model_options<a class="anchor" aria-label="anchor" href="#arg-model-options"></a></dt>
<dd><p>A list containing additional options to be used in the model. Currently, it is possible to fix parameters during the estimation or change the starting values of the parameters. The general structure of the elements of the list is <code>fix_parname</code> and <code>start_parname</code>, where <code>parname</code> stands for the name of the parameter. If <code>fix_parname</code> is not <code>NULL</code>, then the model with be fitted with the <code>parname</code> being fixed at the value that was passed. If <code>start_parname</code> is not <code>NULL</code>, the model will be fitted using the value passed as starting value for <code>parname</code>. the For 'WM' models, the possible elements of the list are: <code>fix_sigma_e</code>, <code>start_sigma_e</code>, <code>fix_nu</code>, <code>start_nu</code>, <code>fix_sigma</code>, <code>start_sigma</code>, <code>fix_range</code>, <code>start_range</code>. Alternatively, one can use <code>fix_sigma_e</code>, <code>start_sigma_e</code>, <code>fix_nu</code>, <code>start_nu</code>, <code>fix_tau</code>, <code>start_tau</code>, <code>fix_kappa</code>, <code>start_kappa</code>. For 'WM1', 'WM2', 'isoExp', 'GL1' and 'GL2' models, the possible elements of the list are <code>fix_sigma_e</code>, <code>start_sigma_e</code>, <code>fix_sigma</code>, <code>start_sigma</code>, <code>fix_range</code>, <code>start_range</code>. Alternatively, one can use <code>fix_sigma_e</code>, <code>start_sigma_e</code>, <code>fix_tau</code>, <code>start_tau</code>, <code>fix_kappa</code>, <code>start_kappa</code>. For 'isoCov' models, the possible values are <code>fix_sigma_e</code>, <code>start_sigma_e</code>, <code>fix_par_vec</code>, <code>start_par_vec</code>. Observe that contrary to the other models, for 'isoCov' models, both <code>fix_par_vec</code> and <code>start_par_vec</code> should be given as vectors of the size of the dimension of the vector for the input of the covariance function passed to the 'isoCov' model. Furthermore, for 'isoCov' models, <code>fix_par_vec</code> is a logical vector, indicating which parameters to be fixed, and the values will be kept fixed to the values given to <code>start_par_vec</code>, one can also use <code>fix_sigma_e</code> and <code>start_sigma_e</code> for controlling the std. deviation of the measurement error.</p></dd>


<dt id="arg-bc">BC<a class="anchor" aria-label="anchor" href="#arg-bc"></a></dt>
<dd><p>For <code>WhittleMatern</code> models, decides which boundary condition to use
(0,1). Here, 0 is Neumann boundary conditions and 1 specifies stationary boundary
conditions.</p></dd>


<dt id="arg-previous-fit">previous_fit<a class="anchor" aria-label="anchor" href="#arg-previous-fit"></a></dt>
<dd><p>An object of class <code>graph_lme</code>. Use the fitted coefficients as starting values.</p></dd>


<dt id="arg-fix-coeff">fix_coeff<a class="anchor" aria-label="anchor" href="#arg-fix-coeff"></a></dt>
<dd><p>If using a previous fit, should all coefficients be fixed at the starting values?</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>logical. Indicating whether to use <code>optimParallel()</code> or not.</p></dd>


<dt id="arg-n-cores">n_cores<a class="anchor" aria-label="anchor" href="#arg-n-cores"></a></dt>
<dd><p>Number of cores to be used if parallel is true.</p></dd>


<dt id="arg-optim-controls">optim_controls<a class="anchor" aria-label="anchor" href="#arg-optim-controls"></a></dt>
<dd><p>Additional controls to be passed to <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim()</a></code> or <code>optimParallel()</code>.</p></dd>


<dt id="arg-improve-hessian">improve_hessian<a class="anchor" aria-label="anchor" href="#arg-improve-hessian"></a></dt>
<dd><p>Should a more precise estimate of the hessian be obtained?
Turning on might increase the overall time.</p></dd>


<dt id="arg-hessian-args">hessian_args<a class="anchor" aria-label="anchor" href="#arg-hessian-args"></a></dt>
<dd><p>List of controls to be used if <code>improve_hessian</code> is <code>TRUE</code>.
The list can contain the arguments to be passed to the <code>method.args</code> argument
in the <code>hessian</code> function. See the help of the <code>hessian</code> function in 'numDeriv'
package for details. Observet that it only accepts the "Richardson" method for
now, the method "complex" is not supported.</p></dd>


<dt id="arg-check-euclidean">check_euclidean<a class="anchor" aria-label="anchor" href="#arg-check-euclidean"></a></dt>
<dd><p>Check if the graph used to compute the resistance distance has Euclidean edges? The graph used to compute the resistance distance has the observation locations as vertices.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing the fitted model.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Bolin, Alexandre Simas, Jonas Wallin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

